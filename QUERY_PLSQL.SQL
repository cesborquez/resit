##################################################################
#    DISPARADORES
##################################################################


#DISPARADOR PARA INGRESAR PRODUCTOS ELABORADOS AL STOCK

create or replace TRIGGER DEVELOPER.TR_PRODUCCION_HORNO
  AFTER INSERT ON PRODUCCION_HORNO
  FOR EACH ROW
DECLARE
-- DECLARACIÃ“N DE VARIABLES PARA CONTENER LOS DATOS INSERTADOS
  CANTIDAD_ELAB   NUMBER;
  PROD_ELAB  INT;
  ID_STOCK INT;
  STOCK_DISPONIBLE NUMBER;
  SUMA_TOTAL NUMBER;

BEGIN
--CARGA DE DATOS OBTENIDOS DEL INGRESO
  CANTIDAD_ELAB := :NEW.CANTIDAD;
  PROD_ELAB     := :NEW.ID_PROD;
--CONSULTA PARA CONOCER EXISTENCIA DE DATOS 
  SELECT ID, DISPONIBLE INTO ID_STOCK, STOCK_DISPONIBLE
  FROM  PRODUCTO_STOCK
  WHERE PRODUCTO_ID = PROD_ELAB;
-- EN CASO DE EXISTIR DATOS, SE SUMAN DE ACUERDO AL TIPO DE PRODUCTO CORRESPONDIENTE
  SUMA_TOTAL := STOCK_DISPONIBLE + CANTIDAD_ELAB;
  UPDATE PRODUCTO_STOCK
  SET DISPONIBLE = SUMA_TOTAL
  WHERE PRODUCTO_ID=PROD_ELAB;
--EN CASO DE NO ENCONTRAR RESULTADOS, INSERTAMOS LOS DATOS INGRESADOS.
  EXCEPTION
  WHEN NO_DATA_FOUND THEN
  INSERT INTO PRODUCTO_STOCK (DISPONIBLE,PRODUCTO_ID)
  VALUES (CANTIDAD_ELAB,PROD_ELAB);
  
END;